REMINDER: This code is copy-paste. Changes here should also be updated there in source repo.
This is a good chance to refactor by learning from this project and applying refactoring to the source repo.

